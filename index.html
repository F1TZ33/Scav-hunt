<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Keyword Scavenger Hunt</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f4f6f8;
      padding: 20px;
    }
    .card {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
    }
    .hunt {
      border: 1px solid #ddd;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 12px;
    }
    button {
      margin: 6px 6px 6px 0;
      padding: 8px 14px;
      cursor: pointer;
    }
    input, textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      z-index: 1000;
    }
  </style>
</head>

<body>

<div class="card" id="app"></div>
<div class="overlay" id="overlay">‚ùå Wrong Keyword! Try Again...</div>

<script>
/* ================= UTIL ================= */
function uid() {
  return Math.random().toString(36).slice(2,9);
}

/* ================= DEFAULT HUNTS ================= */
const DEFAULT_HUNTS = {
  escape: {
    name: "Escape the House",
    intro: "Welcome! Your escape challenge begins now üè†",
    clues: [
      { clue: "I show your face but I‚Äôm not a photo. I hang on walls and doors. Where am I?", keyword: "mirror" },
      { clue: "I have pages but no homework. I‚Äôm quiet unless you drop me. I live where stories sleep.", keyword: "bookshelf" },
      { clue: "I open wide but never talk. I keep food safe and cold. Don‚Äôt forget to close me!", keyword: "fridge" },
      { clue: "I go round and round but never get dizzy. I clean but hate socks in pairs.", keyword: "washing machine" },
      { clue: "I have hands but no arms. I never clap, but I‚Äôm always right on time.", keyword: "clock" },
      { clue: "I hide your feet when you‚Äôre not home. I like pairs, but I‚Äôm often missing one.", keyword: "shoe rack" },
      { clue: "I‚Äôm soft, I‚Äôm comfy, and I steal naps. People sit on me 'just for a minute'.", keyword: "couch" },
      { clue: "I light up the dark but disappear by day. Flip me on.", keyword: "lamp" },
      { clue: "I‚Äôm full of secrets, but I don‚Äôt talk. You knock before opening me.", keyword: "bedroom door" },
      { clue: "You cracked every lock! The final key is hidden where treasures are kept safe. Your Colour is RED", keyword: "red" }
    ],
    finish: "üéâ Congratulations! You escaped the house! Your ribbon colour is RED."
  },

  fortnite: {
    name: "Fortnite IRL",
    intro: "You‚Äôve dropped in. Loot up, survive the storm, and claim the Victory Royale üèÜ",
    clues: [
      { clue: "You‚Äôve dropped in. First loot location: Where controllers go when the game is off.", keyword: "gaming desk" },
      { clue: "Shields up! Find the place where drinks recharge HP.", keyword: "fridge" },
      { clue: "Storm incoming üå™Ô∏è Where do shoes hide when the storm hits outside?", keyword: "entrance" },
      { clue: "You need mats. Wood, brick, metal‚Ä¶ Find where tools live.", keyword: "garage" },
      { clue: "Campfire deployed üî• Where the family gathers to chill.", keyword: "lounge room" },
      { clue: "Inventory check. You can‚Äôt win without sleep.", keyword: "bed" },
      { clue: "Chest nearby‚Ä¶ I hear it. Where secrets are stored behind closed doors.", keyword: "wardrobe" },
      { clue: "Reboot van activated ‚ö° Where devices come back to life.", keyword: "phone charger" },
      { clue: "High ground wins games. Go where you can see the whole room.", keyword: "stairs" },
      { clue: "Final circle. Only one remains. Where battles are watched, not played.", keyword: "tv" },
      { clue: "One last challenge‚Ä¶ Look where snacks disappear during long sessions.", keyword: "pantry" },
      { clue: "VICTORY ROYALE üèÜ Claim your reward where legends are made. Your colour is SILVER", keyword: "silver" }
    ],
    finish: "üèÜ Victory Royale! Your ribbon colour is SILVER."
  },

  hacker: {
    name: "System Breach",
    intro: "SYSTEM ONLINE üîì Initiate breach sequence.",
    clues: [
      { clue: "SYSTEM ONLINE Begin at the device that controls all others.", keyword: "router" },
      { clue: "AUTHENTICATION REQUIRED Find where passwords are written but never stored digitally.", keyword: "notebook" },
      { clue: "DATA COLD STORAGE Files preserved at low temperature.", keyword: "fridge" },
      { clue: "INPUT DEVICE DETECTED Where commands are typed, not spoken.", keyword: "keyboard" },
      { clue: "PERIPHERAL FOUND One click can change everything.", keyword: "mouse" },
      { clue: "POWER SOURCE Without this, the system fails.", keyword: "power board" },
      { clue: "CACHE CLEARED Where clothes are reset to default state.", keyword: "laundry" },
      { clue: "BACKUP LOCATION Where items are stored 'just in case'.", keyword: "garage" },
      { clue: "DISPLAY OUTPUT Pixels form reality here.", keyword: "monitor" },
      { clue: "SECURITY CHECKPOINT Entry requires permission.", keyword: "door" },
      { clue: "ENCRYPTED STORAGE Locked, hidden, not obvious.", keyword: "drawer" },
      { clue: "SYSTEM LOG Tracks everything that happens over time.", keyword: "clock" },
      { clue: "USER PROFILE Where the operator rests.", keyword: "bed" },
      { clue: "FINAL ACCESS NODE Only the admin reaches this point.", keyword: "desk" },
      { clue: "ROOT ACCESS GRANTED SYSTEM BREACHED Retrieve payload from secure location. Your colour is GREEN", keyword: "green" }
    ],
    finish: "üü¢ ACCESS GRANTED. System breached successfully. Your ribbon colour is GREEN."
  }
};

/* ================= STORAGE ================= */
let userHunts = JSON.parse(localStorage.getItem("userHunts") || "{}");
let HUNTS = { ...DEFAULT_HUNTS, ...userHunts };

function save() {
  localStorage.setItem("userHunts", JSON.stringify(userHunts));
}

const q = new URLSearchParams(location.search);
const app = document.getElementById("app");
const overlay = document.getElementById("overlay");

/* ================= ROUTER ================= */
if (q.get("play")) play();
else if (q.get("view")) viewHunt(q.get("view"));
else if (q.get("edit")) createHunt(q.get("edit"));
else if (q.get("new")) createHunt();
else home();

/* ================= HOME ================= */
function home() {
  app.innerHTML = `
    <h1>Keyword Scavenger Hunts</h1>
    <button onclick="location='?new=1'">‚ûï Create New Hunt</button>
    ${Object.entries(HUNTS).map(([k,h]) => `
      <div class="hunt">
        <h3>${h.name}</h3>
        <button onclick="location='?play=${k}&s=0'">‚ñ∂ Start</button>
        <button onclick="location='?edit=${k}'">‚úè Edit</button>
      </div>
    `).join("")}
  `;
}

/* ================= VIEW ================= */
function viewHunt(k) {
  const h = HUNTS[k];
  if (!h) return home();
  app.innerHTML = `
    <h2>${h.name}</h2>
    <p>${h.intro}</p>
    <ol>${h.clues.map(c => `<li>${c.clue}</li>`).join("")}</ol>
    <p>${h.finish}</p>
    <button onclick="home()">‚¨Ö Back</button>
  `;
}

/* ================= CREATE / EDIT ================= */
function createHunt(k) {
  const h = k ? HUNTS[k] : { name:"", intro:"", clues:[], finish:"" };
  app.innerHTML = `
    <h2>${k ? "Edit" : "Create"} Hunt</h2>
    <input id="name" placeholder="Hunt name" value="${h.name}">
    <textarea id="intro" placeholder="Intro">${h.intro}</textarea>
    <div id="clues"></div>
    <button onclick="addClue()">‚ûï Add Clue</button>
    <textarea id="finish" placeholder="Finish">${h.finish}</textarea>
    <button onclick="saveHunt('${k||""}')">üíæ Save</button>
    <button onclick="home()">Cancel</button>
  `;
  h.clues.forEach(c => addClue(c.clue, c.keyword));
}

function addClue(clue="", keyword="") {
  const div = document.createElement("div");
  div.className = "clue-item";
  div.innerHTML = `
    <textarea placeholder="Clue">${clue}</textarea>
    <input placeholder="Keyword" value="${keyword}">
  `;
  document.getElementById("clues").appendChild(div);
}

function saveHunt(k) {
  const name = document.getElementById("name").value.trim();
  const intro = document.getElementById("intro").value.trim();
  const finish = document.getElementById("finish").value.trim();

  const clues = [...document.querySelectorAll(".clue-item")]
    .map(d => ({
      clue: d.querySelector("textarea").value.trim(),
      keyword: d.querySelector("input").value.trim().toLowerCase()
    }))
    .filter(c => c.clue && c.keyword);

  if (!name || !intro || !finish || !clues.length) {
    alert("All fields required");
    return;
  }

  if (!k) k = uid();
  userHunts[k] = { name, intro, clues, finish };
  HUNTS[k] = userHunts[k];
  save();
  home();
}

/* ================= PLAY ================= */
function play() {
  const key = q.get("play");
  const h = HUNTS[key];
  const step = parseInt(q.get("s") || 0);

  if (step === 0) return show(h.intro, "start");

  if (step <= h.clues.length) {
    const c = h.clues[step - 1];
    return show(c.clue, c.keyword);
  }

  show(h.finish, null);
}

function show(text, keyword) {
  app.innerHTML = `
    <p>${text}</p>
    ${keyword ? `
      <input id="ans">
      <button onclick="check('${keyword}')">Submit</button>
    ` : ""}
  `;
}

function check(k) {
  const v = document.getElementById("ans").value.trim().toLowerCase();
  if (v === k) {
    const next = parseInt(q.get("s")) + 1;
    location = `?play=${q.get("play")}&s=${next}`;
  } else {
    overlay.style.display = "flex";
    document.getElementById("ans").value = "";
    setTimeout(() => overlay.style.display = "none", 2000);
  }
}
</script>

</body>
</html>