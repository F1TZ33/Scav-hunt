<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scavenger Hunt Admin</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
.card {
  max-width: 900px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 12px;
}
.hunt {
  border: 1px solid #ddd;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 12px;
}
button {
  margin: 6px 6px 6px 0;
  padding: 8px 14px;
  cursor: pointer;
}
textarea, input {
  width: 100%;
  padding: 8px;
  margin-bottom: 10px;
}
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  color: white;
  font-size: 24px;
  z-index: 1000;
}
@media print {
  button { display: none; }
  body { background: white; }
}
</style>
</head>

<body>

<div class="card" id="app"></div>
<div class="overlay" id="overlay">‚ùå Wrong Keyword! Try Again...</div>

<script>
/* ================= UTIL ================= */
function uid(){ return Math.random().toString(36).slice(2,9); }

/* ================= HUNTS ================= */
const HUNTS = {
  escape: {
    name: "Escape the House",
    intro: "Welcome! Your escape challenge begins now üè†",
    clues: [
      { clue: "I show your face but I‚Äôm not a photo. I hang on walls and doors. Where am I?", keyword: "mirror" },
      { clue: "I have pages but no homework. I‚Äôm quiet unless you drop me. I live where stories sleep.", keyword: "bookshelf" },
      { clue: "I open wide but never talk. I keep food safe and cold. Don‚Äôt forget to close me!", keyword: "fridge" },
      { clue: "I go round and round but never get dizzy. I clean but hate socks in pairs.", keyword: "washing machine" },
      { clue: "I have hands but no arms. I never clap, but I‚Äôm always right on time.", keyword: "clock" },
      { clue: "I hide your feet when you‚Äôre not home. I like pairs, but I‚Äôm often missing one.", keyword: "shoe rack" },
      { clue: "I‚Äôm soft, I‚Äôm comfy, and I steal naps. People sit on me 'just for a minute'.", keyword: "couch" },
      { clue: "I light up the dark but disappear by day. Flip me on.", keyword: "lamp" },
      { clue: "I‚Äôm full of secrets, but I don‚Äôt talk. You knock before opening me.", keyword: "bedroom door" },
      { clue: "You cracked every lock! Your colour is RED", keyword: "red" }
    ],
    finish: "üéâ Congratulations! Ribbon colour: RED."
  },

  fortnite: {
    name: "Fortnite IRL",
    intro: "You‚Äôve dropped in. Loot up and survive the storm!",
    clues: [
      { clue: "First loot location: Where controllers go when the game is off.", keyword: "gaming desk" },
      { clue: "Shields up! Where drinks recharge HP.", keyword: "fridge" },
      { clue: "Storm incoming üå™Ô∏è Where do shoes hide?", keyword: "entrance" },
      { clue: "You need mats. Find where tools live.", keyword: "garage" },
      { clue: "Campfire deployed üî• Where the family gathers.", keyword: "lounge room" },
      { clue: "Inventory check. You can‚Äôt win without sleep.", keyword: "bed" },
      { clue: "Chest nearby‚Ä¶ Where secrets are stored.", keyword: "wardrobe" },
      { clue: "Reboot van ‚ö° Where devices charge.", keyword: "phone charger" },
      { clue: "High ground wins games.", keyword: "stairs" },
      { clue: "Final circle. Battles are watched, not played.", keyword: "tv" },
      { clue: "Snacks disappear here.", keyword: "pantry" },
      { clue: "VICTORY ROYALE üèÜ Your colour is SILVER", keyword: "silver" }
    ],
    finish: "üèÜ Victory Royale! Ribbon colour: SILVER."
  },

  hacker: {
    name: "System Breach",
    intro: "SYSTEM ONLINE üîì Initiate breach sequence.",
    clues: [
      { clue: "Begin at the device that controls all others.", keyword: "router" },
      { clue: "Passwords written, not digital.", keyword: "notebook" },
      { clue: "Data cold storage.", keyword: "fridge" },
      { clue: "Commands typed, not spoken.", keyword: "keyboard" },
      { clue: "One click changes everything.", keyword: "mouse" },
      { clue: "Without this, the system fails.", keyword: "power board" },
      { clue: "Clothes reset to default.", keyword: "laundry" },
      { clue: "Backup location.", keyword: "garage" },
      { clue: "Pixels form reality.", keyword: "monitor" },
      { clue: "Entry requires permission.", keyword: "door" },
      { clue: "Locked, hidden storage.", keyword: "drawer" },
      { clue: "Tracks everything over time.", keyword: "clock" },
      { clue: "Operator rest location.", keyword: "bed" },
      { clue: "Final access node.", keyword: "desk" },
      { clue: "ROOT ACCESS GRANTED. Your colour is GREEN", keyword: "green" }
    ],
    finish: "üü¢ ACCESS GRANTED. Ribbon colour: GREEN."
  }
};

const q = new URLSearchParams(location.search);
const app = document.getElementById("app");
const overlay = document.getElementById("overlay");

/* ================= ROUTER ================= */
if (q.get("play")) play();
else if (q.get("print")) printHunt(q.get("print"));
else if (q.get("edit")) editHunt(q.get("edit"));
else home();

/* ================= HOME (ADMIN ONLY) ================= */
function home(){
  app.innerHTML = `
    <h1>Scavenger Hunt Admin</h1>
    ${Object.entries(HUNTS).map(([k,h])=>`
      <div class="hunt">
        <h3>${h.name}</h3>
        <button onclick="location='?print=${k}'">üñ®Ô∏è Print Instructions</button>
        <button onclick="location='?edit=${k}'">‚úè Edit</button>
      </div>
    `).join("")}
  `;
}

/* ================= PRINT ================= */
function printHunt(k){
  const h = HUNTS[k];
  app.innerHTML = `
    <h2>${h.name}</h2>
    <p>${h.intro}</p>
    <ol>${h.clues.map(c=>`<li>${c.clue}</li>`).join("")}</ol>
    <p>${h.finish}</p>
    <p><strong>Start URL (QR code target):</strong><br>
    ${location.origin + location.pathname}?play=${k}&s=0</p>
    <button onclick="window.print()">üñ®Ô∏è Print</button>
    <button onclick="home()">‚¨Ö Back</button>
  `;
}

/* ================= EDIT ================= */
function editHunt(k){
  const h = HUNTS[k];
  app.innerHTML = `
    <h2>Edit ${h.name}</h2>
    <textarea id="intro">${h.intro}</textarea>
    <div id="clues"></div>
    <textarea id="finish">${h.finish}</textarea>
    <button onclick="saveHunt('${k}')">üíæ Save</button>
    <button onclick="home()">Cancel</button>
  `;
  h.clues.forEach(c=>addClue(c.clue,c.keyword));
}

function addClue(clue="",keyword=""){
  const d=document.createElement("div");
  d.innerHTML=`<textarea>${clue}</textarea><input value="${keyword}">`;
  document.getElementById("clues").appendChild(d);
}

function saveHunt(k){
  const intro=document.getElementById("intro").value.trim();
  const finish=document.getElementById("finish").value.trim();
  const clues=[...document.querySelectorAll("#clues div")].map(d=>({
    clue:d.children[0].value.trim(),
    keyword:d.children[1].value.trim().toLowerCase()
  })).filter(c=>c.clue&&c.keyword);
  HUNTS[k]={...HUNTS[k],intro,clues,finish};
  home();
}

/* ================= PLAY (QR ONLY) ================= */
function play(){
  const h=HUNTS[q.get("play")];
  const step=parseInt(q.get("s")||0);
  if(step===0) return show(h.intro,"start");
  if(step<=h.clues.length) return show(h.clues[step-1].clue,h.clues[step-1].keyword);
  show(h.finish,null);
}

function show(text,keyword){
  app.innerHTML=`
    <p>${text}</p>
    ${keyword?`<input id="ans"><button onclick="check('${keyword}')">Submit</button>`:""}
  `;
}

function check(k){
  const v=document.getElementById("ans").value.trim().toLowerCase();
  if(v===k){
    location=`?play=${q.get("play")}&s=${parseInt(q.get("s"))+1}`;
  } else {
    overlay.style.display="flex";
    document.getElementById("ans").value="";
    setTimeout(()=>overlay.style.display="none",2000);
  }
}
</script>

</body>
</html>